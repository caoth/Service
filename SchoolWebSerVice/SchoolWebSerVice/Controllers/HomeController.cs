using SchoolWebSerVice.Models;
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Net;
using System.Text;
using System.Web;
using System.Web.Mvc;


namespace SchoolWebSerVice.Controllers
{
    public class HomeController : Controller
    {
        public ActionResult Index()
        {
            CookieContainer cookieContainer = new CookieContainer();

            HttpWebRequest request = (HttpWebRequest)WebRequest.Create("http://thongtindaotao.sgu.edu.vn/Default.aspx?page=xemdiemthi&id=3111410086");
            request.CookieContainer = cookieContainer;
            request.Method = "POST";
            request.ContentType = "application/x-www-form-urlencoded";
            string target = "ctl00%24ContentPlaceHolder1%24ctl00%24lnkChangeview2";
            string viewState = "%2FwEPDwUKLTMxNjc3NTM3NQ9kFgJmD2QWAgIDD2QWCAIDD2QWBGYPZBYCAgEPZBYCAgUPDxYCHgRUZXh0BQ3EkMSDbmcgTmjhuq1wZGQCAQ9kFgICAQ9kFgICBQ8PFgIfAAUNxJDEg25nIE5o4bqtcGRkAgUPZBY8AgEPDxYEHghDc3NDbGFzcwUIb3V0LW1lbnUeBF8hU0ICAmQWAgIBDw8WAh8ABQtUUkFORyBDSOG7pmRkAgMPDxYEHwEFCG91dC1tZW51HwICAmQWAgIBDw8WAh8ABRnEkMOBTkggR0nDgSBHSeG6ok5HIEThuqBZZGQCBQ8PFgQfAQUIb3V0LW1lbnUfAgICZBYCAgEPDxYCHwAFFcSQxIJORyBLw50gTcOUTiBI4buMQ2RkAgcPDxYGHwEFCG91dC1tZW51HwICAh4HVmlzaWJsZWhkZAIJDw8WBB8BBQhvdXQtbWVudR8CAgJkFgICAQ8PFgIfAAUOWEVNIEzhu4pDSCBUSElkZAILDw8WBB8BBQhvdXQtbWVudR8CAgJkFgICAQ8PFgIfAAUUWEVNIEzhu4pDSCBUSEkgTOG6oElkZAINDw8WBh8BBQhvdXQtbWVudR8CAgIfA2hkFgICAQ8PFgIfAAURWEVNIEzhu4pDSCBUSEkgR0tkZAIPDw8WBB8BBQhvdXQtbWVudR8CAgJkFgICAQ8PFgIfAAUHWEVNIFRLQmRkAhEPDxYEHwEFCG91dC1tZW51HwICAmQWAgIBDw8WAh8ABQ5YRU0gSOG7jEMgUEjDjWRkAhMPDxYEHwEFCW92ZXItbWVudR8CAgJkFgICAQ8PFgIfAAULWEVNIMSQSeG7gk1kZAIVDw8WBB8BBQhvdXQtbWVudR8CAgJkFgICAQ8PFgIfAAUSU%2BG7rEEgVFQgQ8OBIE5Iw4JOZGQCFw8PFgQfAQUIb3V0LW1lbnUfAgICZBYCAgEPDxYCHwAFF0RBTkggTeG7pEMgQ0jhu6hDIE7Egk5HZGQCGQ8PFgYfAQUIb3V0LW1lbnUfAgICHwNoZBYCAgEPDxYCHwAFEFPhu6xBIEzDnSBM4buKQ0hkZAIbDw8WBh8BBQhvdXQtbWVudR8CAgIfA2hkZAIdDw8WBB8BBQhvdXQtbWVudR8CAgJkFgICAQ8PFgIfAAUOR8OTUCDDnSBLSeG6vk5kZAIfDw8WBB8BBQhvdXQtbWVudR8CAgJkFgICAQ8PFgIfAAUZUVXhuqJOIEzDnSBOR8av4bucSSBEw5lOR2RkAiEPDxYEHwEFCG91dC1tZW51HwICAmQWAgIBDw8WAh8ABRdL4bq%2BVCBRVeG6oiDEkMOBTkggR0nDgWRkAiMPDxYEHwEFCG91dC1tZW51HwICAmQWAgIBDw8WAh8ABRrEkMOBTkggR0nDgSBUUuG7sEMgVFVZ4bq%2BTmRkAiUPDxYEHwEFCG91dC1tZW51HwICAmQWAgIBDw8WAh8ABRTEkMSCTkcgS8OdIFRISSBM4bqgSWRkAicPDxYEHwEFCG91dC1tZW51HwICAmRkAikPDxYEHwEFCG91dC1tZW51HwICAmQWAgIBDw8WAh8ABRLEkEsgQ0hVWcOKTiBOR8OATkhkZAIrDw8WBB8BBQhvdXQtbWVudR8CAgJkFgICAQ8PFgIfAAUXxJBLIFjDiVQgVOG7kFQgTkdISeG7hlBkZAItDw8WBB8BBQhvdXQtbWVudR8CAgJkFgICAQ8PFgIfAAUWS1EgWMOJVCBU4buQVCBOR0hJ4buGUGRkAi8PDxYEHwEFCG91dC1tZW51HwICAmQWAgIBDw8WAh8ABQlYRU0gQ1TEkFRkZAIxDw8WBB8BBQhvdXQtbWVudR8CAgJkFgICAQ8PFgIfAAULWEVNIE3DlE4gVFFkZAIzDw8WBB8BBQhvdXQtbWVudR8CAgJkFgICAQ8PFgIfAAUaQ8OCVSBI4buOSSBUSMav4bucTkcgR%2BG6tlBkZAI1Dw8WBB8BBQhvdXQtbWVudR8CAgJkFgICAQ8PFgIfAAUJbGJsREtLTFROZGQCNw8PFgQfAQUIb3V0LW1lbnUfAgICZBYCAgEPDxYCHwAFEWxibE5oYXBEaWVtb25saW5lZGQCOQ8PFgQfAQUIb3V0LW1lbnUfAgICZGQCOw8PFgQfAQUIb3V0LW1lbnUfAgICZGQCBw9kFgICAQ9kFgJmD2QWCAIFD2QWHgIBDw8WAh8ABQ5Nw6Mgc2luaCB2acOqbmRkAgMPDxYCHwAFCjMxMTQ0MTAwODlkZAIFDw8WAh8ABQ9Uw6puIHNpbmggdmnDqm5kZAIHDw8WAh8ABRJUcuG6p24gVGhhbmggTmfDom5kZAIRDw8WAh8ABQVM4bubcGRkAhMPDxYCHwAFCkRDVDExNDMoIClkZAIVDw8WAh8ABQZOZ8OgbmhkZAIXDw8WAh8ABRdDw7RuZyBuZ2jhu4cgdGjDtG5nIHRpbmRkAhkPDxYCHwAFBEtob2FkZAIbDw8WAh8ABRdDw7RuZyBuZ2jhu4cgdGjDtG5nIHRpbmRkAh0PDxYCHwAFEEjhu4cgxJHDoG8gdOG6oW9kZAIfDw8WAh8ABSTEkOG6oWkgaOG7jWMgY2jDrW5oIHF1eSAodMOtbiBjaOG7iSlkZAIhDw8WAh8ABQtLaMOzYSBo4buNY2RkAiMPDxYCHwAFCTIwMTQtMjAxOWRkAiUPDxYCHwAFFkPhu5EgduG6pW4gaOG7jWMgdOG6rXBkZAIJD2QWDAIBDw8WAh8ABRxI4buNYyBr4buzIDMgTsSDbSBo4buNYyAyMDE0ZGQCAw8PFgIfAAUtTmjhuq1wIGjhu41jIGvhu7MgeGVtIMSRaeG7g20gdGhpICh2ZCAyMDA2MSk6ZGQCBw8PFgIfAAUDWGVtZGQCCw9kFgICAQ9kFgJmDw8WBB8BBQp2aWV3LXRhYmxlHwICAmRkAg0PDxYCHwAFHEjhu41jIGvhu7MgMyBOxINtIGjhu41jIDIwMTRkZAIPDw8WAh8ABUcoICBE4buvIGxp4buHdSDEkcaw4bujYyBj4bqtcCBuaOG6rXQgdsOgbyBsw7pjOiA4OjMzIE5nw6B5OiAxNi84LzIwMTUgKWRkAgsPDxYCHwNoZBYEAgMPEGRkFgBkAgUPPCsADQBkAg0PFgIeCWlubmVyaHRtbAUOSU4gxJBJ4buCTSBUSElkAgkPZBYIAgEPDxYCHwAFP0NvcHlyaWdodCDCqTIwMDkgVHLGsOG7nW5nIMSQ4bqhaSBI4buNYyBTw6BpIEfDsm5sYmxQaG9uZ1F1YW5MeWRkAgMPDxYCHwAFC1RyYW5nIENo4bunZGQCBQ8PFgIfAAUtVGhp4bq%2FdCBr4bq%2FIGLhu59pIGN0eSBQaOG6p24gbeG7gW0gQW5oIFF1w6JuZGQCBw8PFgIfAAUMxJDhuqd1IFRyYW5nZGQYAgUeX19Db250cm9sc1JlcXVpcmVQb3N0QmFja0tleV9fFgIFOmN0bDAwJENvbnRlbnRQbGFjZUhvbGRlcjEkY3RsMDAkTWVzc2FnZUJveDEkaW1nQ2xvc2VCdXR0b24FMWN0bDAwJENvbnRlbnRQbGFjZUhvbGRlcjEkY3RsMDAkTWVzc2FnZUJveDEkYnRuT2sFKWN0bDAwJENvbnRlbnRQbGFjZUhvbGRlcjEkY3RsMDAkZ3ZYZW1EaWVtD2dk";
            string data = string.Format("__EVENTTARGET={0}&__VIEWSTATE={1}", target, viewState);

            System.Diagnostics.Debug.WriteLine(data);
            request.ContentLength = data.Length;
            request.Headers.Add("Authorization: Basic ZGNpOkFpR2g3YWVj");

            StreamWriter requestWriter = new StreamWriter(request.GetRequestStream());
            requestWriter.Write(data);
            requestWriter.Close();

            HttpWebResponse response = (HttpWebResponse)request.GetResponse();
            string responseString = new StreamReader(response.GetResponseStream()).ReadToEnd();
            ViewBag.Messenger = responseString;
            return View();
        }
    }
}
